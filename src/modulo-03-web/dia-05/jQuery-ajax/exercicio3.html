<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title></title>
</head>
<body>

  <input name="escreva" type="text" id="nomeArtista" placeholder="Artista">
  <button id="button">Inserir</button>

  <h2>Exercicio 2</h2>


	<script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
	<script type="text/javascript">

      $("#button").click(function(){
        nome=$("#nomeArtista").val();
        consultarArtista(nome);
      });

        function sortear () {
          return Math.random() < 0.2;
        }
        function consultarArtista(nome) {
          var sorteio = true;
          if(nome.toLowerCase() === 'justin bieber'){
            sorteio = sortear();
          }
          if (sorteio) {
            $.get('https://api.spotify.com/v1/search?q='+nome+'&type=artist')
            .done(function (elem) {
            var id = elem.artists.items[0].id;
            consultarSpotify(id);
            })
          } else{
            $.get('https://api.spotify.com/v1/artists/douchebag/albums?limit=50')
            .error(function( xhr, status, errorThrown) {
                $('h2').html('Caro usuário, devido a um erro '+ xhr.status +', não foi possível pesquisar por '+ nome);
            });
            
          }
          
        };


        function consultarSpotify(id) {

          $('h2').empty();
          
          var url='https://api.spotify.com/v1/artists/'+id+'/albums?limit=50';

          $.get(url)
          .done(function(data) {
            var images = data.items;
            images.forEach(function(elem) {
              if(elem.images.length !== 0){
                $('h2').append(
                  $('<img>')
                    .attr('src', elem.images[1].url)
                )
              }
            });
          });
        };
        

    </script>
</body>
</html>